<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>API í…ŒìŠ¤íŠ¸ - JLPT ë¬¸ì œ ìƒì„±ê¸°</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 16px;
        padding: 30px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }

      h1 {
        color: #667eea;
        margin-bottom: 20px;
        font-size: 28px;
      }

      .test-section {
        margin: 20px 0;
        padding: 20px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
      }

      button {
        background: #667eea;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s;
        margin: 5px;
      }

      button:hover {
        background: #5568d3;
        transform: translateY(-2px);
      }

      button:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
      }

      .result {
        margin-top: 15px;
        padding: 15px;
        border-radius: 8px;
        font-family: monospace;
        font-size: 14px;
        white-space: pre-wrap;
        word-break: break-all;
      }

      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }

      .loading {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeeba;
      }

      .status-indicator {
        display: inline-block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-right: 8px;
      }

      .status-online {
        background: #28a745;
      }
      .status-offline {
        background: #dc3545;
      }
      .status-unknown {
        background: #ffc107;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ”§ API ë””ë²„ê¹… í…ŒìŠ¤íŠ¸ í˜ì´ì§€</h1>

      <!-- ìƒíƒœ í™•ì¸ -->
      <div class="test-section">
        <h2>1. API ìƒíƒœ í™•ì¸</h2>
        <button onclick="checkAPIStatus()">ìƒíƒœ ì²´í¬</button>
        <div id="statusResult"></div>
      </div>

      <!-- ê¸°ë³¸ í…ŒìŠ¤íŠ¸ -->
      <div class="test-section">
        <h2>2. ê¸°ë³¸ ë¬¸ì œ ìƒì„± í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testBasicGeneration()">N1 ì¤‘ê°„ ë¬¸ì œ ìƒì„±</button>
        <div id="basicResult"></div>
      </div>

      <!-- ë‹¤ì–‘í•œ ì˜µì…˜ í…ŒìŠ¤íŠ¸ -->
      <div class="test-section">
        <h2>3. ë‹¤ì–‘í•œ ì˜µì…˜ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testShortProblem()">ì§§ì€ ë¬¸ì œ</button>
        <button onclick="testLongProblem()">ê¸´ ë¬¸ì œ</button>
        <button onclick="testComparative()">ë¹„êµí˜•</button>
        <button onclick="testN2Level()">N2 ë ˆë²¨</button>
        <div id="optionsResult"></div>
      </div>

      <!-- ì—ëŸ¬ í•¸ë“¤ë§ í…ŒìŠ¤íŠ¸ -->
      <div class="test-section">
        <h2>4. ì—ëŸ¬ í•¸ë“¤ë§</h2>
        <button onclick="testInvalidRequest()">ì˜ëª»ëœ ìš”ì²­</button>
        <button onclick="testBackupSystem()">ë°±ì—… ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</button>
        <div id="errorResult"></div>
      </div>
    </div>

    <script>
      const API_BASE = window.location.origin;

      // ê²°ê³¼ í‘œì‹œ í—¬í¼
      function showResult(elementId, message, type = "info") {
        const element = document.getElementById(elementId);
        element.className = `result ${type}`;
        element.textContent = message;
      }

      // 1. API ìƒíƒœ í™•ì¸
      async function checkAPIStatus() {
        showResult("statusResult", "í™•ì¸ ì¤‘...", "loading");

        try {
          const response = await fetch(`${API_BASE}/api/generate-reading`, {
            method: "OPTIONS",
          });

          if (response.ok) {
            showResult(
              "statusResult",
              `âœ… API ì„œë²„ ì˜¨ë¼ì¸\n` +
                `ìƒíƒœ: ${response.status}\n` +
                `URL: ${API_BASE}/api/generate-reading`,
              "success"
            );
          } else {
            showResult(
              "statusResult",
              `âš ï¸ API ì„œë²„ ì‘ë‹µ ì´ìƒ\n` + `ìƒíƒœ: ${response.status}`,
              "error"
            );
          }
        } catch (error) {
          showResult(
            "statusResult",
            `âŒ API ì„œë²„ ì—°ê²° ì‹¤íŒ¨\n` +
              `ì—ëŸ¬: ${error.message}\n` +
              `í™•ì¸ ì‚¬í•­:\n` +
              `1. Next.js ì„¤ì¹˜ ì—¬ë¶€ (npm install next)\n` +
              `2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (ANTHROPIC_API_KEY)\n` +
              `3. Vercel ë°°í¬ ìƒíƒœ`,
            "error"
          );
        }
      }

      // 2. ê¸°ë³¸ ë¬¸ì œ ìƒì„±
      async function testBasicGeneration() {
        showResult("basicResult", "ìƒì„± ì¤‘...", "loading");

        const payload = {
          lengthKey: "medium",
          levels: ["N1"],
        };

        try {
          const response = await fetch(`${API_BASE}/api/generate-reading`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          const data = await response.json();

          if (data.success) {
            showResult(
              "basicResult",
              `âœ… ë¬¸ì œ ìƒì„± ì„±ê³µ!\n\n` +
                `ë ˆë²¨: ${data.metadata?.level}\n` +
                `ì£¼ì œ: ${data.metadata?.topic}\n` +
                `ë¬¸ì œ ìˆ˜: ${data.problem?.questions?.length}\n` +
                `ë³¸ë¬¸ ê¸¸ì´: ${data.problem?.passage?.length}ì\n\n` +
                `ì²« ë²ˆì§¸ ë¬¸ì œ: ${data.problem?.questions?.[0]?.question}`,
              "success"
            );
          } else {
            showResult(
              "basicResult",
              `âš ï¸ ìƒì„± ì‹¤íŒ¨\n${data.error || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`,
              "error"
            );
          }
        } catch (error) {
          showResult("basicResult", `âŒ ìš”ì²­ ì‹¤íŒ¨\n${error.message}`, "error");
        }
      }

      // 3. ì§§ì€ ë¬¸ì œ í…ŒìŠ¤íŠ¸
      async function testShortProblem() {
        showResult("optionsResult", "ì§§ì€ ë¬¸ì œ ìƒì„± ì¤‘...", "loading");
        await testWithOptions(
          { lengthKey: "short", levels: ["N1"] },
          "optionsResult"
        );
      }

      // ê¸´ ë¬¸ì œ í…ŒìŠ¤íŠ¸
      async function testLongProblem() {
        showResult("optionsResult", "ê¸´ ë¬¸ì œ ìƒì„± ì¤‘...", "loading");
        await testWithOptions(
          { lengthKey: "long", levels: ["N1"] },
          "optionsResult"
        );
      }

      // ë¹„êµí˜• í…ŒìŠ¤íŠ¸
      async function testComparative() {
        showResult("optionsResult", "ë¹„êµí˜• ë¬¸ì œ ìƒì„± ì¤‘...", "loading");
        await testWithOptions(
          { lengthKey: "comparative", levels: ["N1"] },
          "optionsResult"
        );
      }

      // N2 ë ˆë²¨ í…ŒìŠ¤íŠ¸
      async function testN2Level() {
        showResult("optionsResult", "N2 ë¬¸ì œ ìƒì„± ì¤‘...", "loading");
        await testWithOptions(
          { lengthKey: "medium", levels: ["N2"] },
          "optionsResult"
        );
      }

      // ì˜µì…˜ í…ŒìŠ¤íŠ¸ í—¬í¼
      async function testWithOptions(payload, resultId) {
        try {
          const response = await fetch(`${API_BASE}/api/generate-reading`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          const data = await response.json();

          if (data.success) {
            showResult(
              resultId,
              `âœ… ì„±ê³µ!\n` +
                `ì„¤ì •: ${payload.lengthKey} / ${payload.levels.join(",")}\n` +
                `ì£¼ì œ: ${data.metadata?.topic}`,
              "success"
            );
          } else {
            showResult(resultId, `âš ï¸ ì‹¤íŒ¨: ${data.error}`, "error");
          }
        } catch (error) {
          showResult(resultId, `âŒ ì—ëŸ¬: ${error.message}`, "error");
        }
      }

      // 4. ì˜ëª»ëœ ìš”ì²­ í…ŒìŠ¤íŠ¸
      async function testInvalidRequest() {
        showResult("errorResult", "ì˜ëª»ëœ ìš”ì²­ í…ŒìŠ¤íŠ¸ ì¤‘...", "loading");

        try {
          const response = await fetch(`${API_BASE}/api/generate-reading`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ invalid: "data" }),
          });

          const data = await response.json();
          showResult(
            "errorResult",
            `ì„œë²„ ì‘ë‹µ:\n${JSON.stringify(data, null, 2)}`,
            data.success ? "success" : "info"
          );
        } catch (error) {
          showResult("errorResult", `ì—ëŸ¬ ì²˜ë¦¬ í™•ì¸: ${error.message}`, "info");
        }
      }

      // ë°±ì—… ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
      async function testBackupSystem() {
        showResult(
          "errorResult",
          "ë°±ì—… ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ (ì˜ë„ì  ì‹¤íŒ¨)...",
          "loading"
        );

        // ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì—”ë“œí¬ì¸íŠ¸ë¡œ ìš”ì²­
        try {
          const response = await fetch(`${API_BASE}/api/nonexistent`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ lengthKey: "medium", levels: ["N1"] }),
          });

          showResult(
            "errorResult",
            `ë°±ì—… ì‹œìŠ¤í…œì´ ì‘ë™í•´ì•¼ í•©ë‹ˆë‹¤.\n` +
              `ì‘ë‹µ ìƒíƒœ: ${response.status}`,
            "info"
          );
        } catch (error) {
          showResult(
            "errorResult",
            `âœ… ë°±ì—… ì‹œìŠ¤í…œ ì‘ë™ í™•ì¸\n` +
              `ì—ëŸ¬ê°€ ë°œìƒí–ˆì§€ë§Œ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì²˜ë¦¬ë¨: ${error.message}`,
            "success"
          );
        }
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ìƒíƒœ í™•ì¸
      window.addEventListener("load", () => {
        checkAPIStatus();
      });
    </script>
  </body>
</html>
