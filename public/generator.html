<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JLPT N1 독해 문제 생성기 (고급)</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <meta name="theme-color" content="#3B82F6" />
    <meta
      name="description"
      content="Claude AI가 실시간으로 새로운 JLPT N1 독해 문제를 생성합니다 - 25가지 세부 유형 지원"
    />

    <!-- 파비콘 설정 -->
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>📖</text></svg>"
    />

    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
          sans-serif;
      }
      .subtype-badge {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        font-size: 0.75rem;
        font-weight: 500;
        background-color: #f3e8ff;
        color: #7c3aed;
        border-radius: 9999px;
      }
      .difficulty-badge {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        font-size: 0.75rem;
        font-weight: 500;
        border-radius: 9999px;
      }
      .difficulty-basic {
        background-color: #d1fae5;
        color: #065f46;
      }
      .difficulty-advanced {
        background-color: #fee2e2;
        color: #b91c1c;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;
      const { createRoot } = ReactDOM;

      // 길이 정의 (프론트엔드 표시용 - 실제 데이터는 백엔드에서 로드)
      const LENGTH_OPTIONS = {
        short: {
          label: "단문 (短文)",
          description: "짧은 지문으로 핵심 내용 파악",
          characterRange: "200~400자",
          questionCount: "1문항",
          icon: "📄",
          subtypes: 5,
        },
        medium: {
          label: "중문 (中文)",
          description: "적당한 길이의 논설문이나 설명문",
          characterRange: "450~700자",
          questionCount: "1~2문제",
          icon: "📃",
          subtypes: 5,
        },
        long: {
          label: "장문 (長文)",
          description: "긴 지문으로 심화된 독해력 평가",
          characterRange: "800~1200자",
          questionCount: "3~5문제",
          icon: "📑",
          subtypes: 5,
        },
        comparative: {
          label: "종합 이해 (統合理解)",
          description: "두 개의 지문을 비교 분석",
          characterRange: "각 300~500자 (총 2개 지문)",
          questionCount: "복합 문제",
          icon: "📊",
          subtypes: 5,
        },
        practical: {
          label: "정보 검색 (情報検索)",
          description: "실용문서나 자료를 활용한 정보 검색",
          characterRange: "600~1200자",
          questionCount: "정보 검색 문제",
          icon: "📋",
          subtypes: 5,
        },
      };

      // 로딩 아이콘 컴포넌트
      const LoaderIcon = () => (
        <svg
          className="animate-spin -ml-1 mr-3 h-5 w-5 text-white"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
        >
          <circle
            className="opacity-25"
            cx="12"
            cy="12"
            r="10"
            stroke="currentColor"
            strokeWidth="4"
          ></circle>
          <path
            className="opacity-75"
            fill="currentColor"
            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
          ></path>
        </svg>
      );

      const ReadingGenerator = () => {
        const [currentProblem, setCurrentProblem] = useState(null);
        const [customPrompt, setCustomPrompt] = useState("");
        const [generationType, setGenerationType] = useState("auto"); // 'auto' or 'custom'
        const [selectedLength, setSelectedLength] = useState("medium");
        const [showAnswer, setShowAnswer] = useState(false);
        const [score, setScore] = useState({ correct: 0, total: 0 });
        const [isGenerating, setIsGenerating] = useState(false);
        const [generationHistory, setGenerationHistory] = useState([]);
        const [apiStatus, setApiStatus] = useState("확인 중...");
        const [debugInfo, setDebugInfo] = useState([]);

        // 디버그 로그 함수
        const addDebugLog = (message, data = null) => {
          const logEntry = {
            timestamp: new Date().toLocaleTimeString(),
            message,
            data: data ? JSON.stringify(data, null, 2) : null,
          };
          setDebugInfo((prev) => [logEntry, ...prev.slice(0, 4)]);
          console.log(`[DEBUG] ${message}`, data);
        };

        // API 상태 확인
        const checkAPIStatus = async () => {
          try {
            await new Promise((resolve) => setTimeout(resolve, 1000));
            setApiStatus("🟢 독해 생성 API 준비됨 (25가지 유형)");
          } catch (error) {
            setApiStatus("🔴 API 연결 실패");
          }
        };

        useEffect(() => {
          checkAPIStatus();
        }, []);

        // 문제 생성 함수
        const generateProblem = async () => {
          addDebugLog("독해 문제 생성 시작", {
            type: generationType,
            length: selectedLength,
          });
          setIsGenerating(true);
          setCurrentProblem(null);
          setShowAnswer(false);

          try {
            // API 요청 데이터 구성
            const requestData =
              generationType === "custom" && customPrompt.trim()
                ? {
                    type: "custom",
                    prompt: customPrompt.trim(),
                    length: selectedLength,
                  }
                : {
                    type: "generate",
                    length: selectedLength,
                  };

            addDebugLog("API 요청 데이터", requestData);

            const response = await fetch("/api/generate-reading", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(requestData),
            });

            addDebugLog("API 응답 상태", {
              status: response.status,
              statusText: response.statusText,
              ok: response.ok,
            });

            if (!response.ok) {
              throw new Error(
                `HTTP ${response.status}: ${response.statusText}`
              );
            }

            const data = await response.json();
            addDebugLog("API 응답 데이터", data);

            if (data.success) {
              const problem = {
                ...data.problem,
                id: Date.now(),
                displayedAt: new Date().toLocaleString("ko-KR"),
              };

              setCurrentProblem(problem);
              setGenerationHistory((prev) => [problem, ...prev.slice(0, 9)]);
              addDebugLog("문제 생성 성공", {
                problemId: problem.id,
                subtype: problem.subtype,
                trapDifficulty: problem.trapDifficulty,
              });

              // 커스텀 프롬프트 성공 시 초기화
              if (generationType === "custom") {
                setCustomPrompt("");
              }
            } else {
              // API에서 백업 문제 반환
              const problem = {
                ...data.problem,
                id: Date.now(),
                displayedAt: new Date().toLocaleString("ko-KR"),
                isBackup: true,
              };

              setCurrentProblem(problem);
              addDebugLog("백업 문제 사용", data.message);
            }
          } catch (error) {
            addDebugLog("생성 실패", error.message);

            // 최종 대안: 클라이언트 측 백업 문제
            const fallbackProblem = {
              type: "reading",
              length: selectedLength,
              subtype: "fallback",
              topic: "기술과 사회 변화",
              passage:
                "現代社会において、技術の進歩は我々の生活を大きく変えている。特にスマートフォンの普及により、いつでもどこでも情報にアクセスできるようになった。しかし、この便利さの一方で、人々の集中力低下や対面コミュニケーションの減少といった問題も指摘されている。",
              question:
                "この文章で述べられている技術の進歩について最も適切なものはどれですか。",
              choices: [
                "便利さと問題の両面があることを示している",
                "完全に肯定的な影響しかないと述べている",
                "技術の進歩が遅いことを批判している",
                "スマートフォン以外の技術について論じている",
              ],
              correct: 0,
              explanation:
                "문장에서는 기술 진보의 편리함과 함께 집중력 저하, 대면 소통 감소 등의 문제점도 함께 언급하고 있습니다.",
              source: "클라이언트 백업",
              id: Date.now(),
              displayedAt: new Date().toLocaleString("ko-KR"),
              isError: true,
            };

            setCurrentProblem(fallbackProblem);
            alert(`문제 생성 실패: ${error.message}\n백업 문제를 표시합니다.`);
          }

          setIsGenerating(false);
        };

        // 답안 처리 - 다중 문제 지원
        const handleAnswer = (questionIndex, selectedIndex) => {
          if (!currentProblem) return;

          let isCorrect = false;

          // 단일 문제인 경우
          if (typeof currentProblem.correct === "number") {
            isCorrect = selectedIndex === currentProblem.correct;
          }
          // 다중 문제인 경우
          else if (
            currentProblem.questions &&
            currentProblem.questions[questionIndex]
          ) {
            isCorrect =
              selectedIndex === currentProblem.questions[questionIndex].correct;
          }

          if (isCorrect) {
            setScore((prev) => ({
              correct: prev.correct + 1,
              total: prev.total + 1,
            }));
          } else {
            setScore((prev) => ({ ...prev, total: prev.total + 1 }));
          }
          setShowAnswer(true);
        };

        // 답안 스타일링 - 다중 문제 지원
        const getButtonStyle = (questionIndex, choiceIndex) => {
          if (!showAnswer) {
            return "bg-white hover:bg-blue-50 border border-gray-300 text-gray-700";
          }

          let correctIndex;
          if (typeof currentProblem.correct === "number") {
            correctIndex = currentProblem.correct;
          } else if (
            currentProblem.questions &&
            currentProblem.questions[questionIndex]
          ) {
            correctIndex = currentProblem.questions[questionIndex].correct;
          }

          if (choiceIndex === correctIndex) {
            return "bg-green-100 border-green-500 text-green-800";
          } else {
            return "bg-red-100 border-red-300 text-red-700";
          }
        };

        // 안전한 문자열 렌더링 함수
        const safeRenderText = (value) => {
          if (typeof value === "string") {
            return value;
          } else if (typeof value === "object" && value !== null) {
            if (value.topic) return value.topic;
            if (value.category) return value.category;
            if (value.label) return value.label;
            return JSON.stringify(value);
          }
          return String(value);
        };

        // 세부 유형 정보 렌더링
        const renderSubtypeInfo = (problem) => {
          if (!problem.subtypeInfo) return null;

          return (
            <div className="mb-4 p-3 bg-purple-50 rounded border-l-4 border-purple-400">
              <div className="flex items-center gap-2 mb-2">
                <span className="subtype-badge">
                  {problem.subtypeInfo.definition?.label || problem.subtype}
                </span>
                {problem.trapDifficulty && (
                  <span
                    className={`difficulty-badge ${
                      problem.trapDifficulty === "고난이도"
                        ? "difficulty-advanced"
                        : "difficulty-basic"
                    }`}
                  >
                    {problem.trapDifficulty}
                  </span>
                )}
              </div>
              <p className="text-sm text-purple-800">
                <strong>유형 특징:</strong>{" "}
                {problem.subtypeInfo.definition?.description}
              </p>
              {problem.subtypeInfo.definition?.question_focus && (
                <p className="text-sm text-purple-800 mt-1">
                  <strong>질문 초점:</strong>{" "}
                  {problem.subtypeInfo.definition.question_focus}
                </p>
              )}
            </div>
          );
        };

        // 문제 렌더링 함수
        const renderProblem = () => {
          if (!currentProblem) return null;

          // 단일 문제인 경우
          if (currentProblem.question && currentProblem.choices) {
            return (
              <div>
                <div className="mb-6">
                  <p className="text-lg mb-4">
                    <span className="font-bold">{currentProblem.question}</span>
                  </p>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4">
                  {currentProblem.choices?.map((choice, index) => (
                    <button
                      key={index}
                      onClick={() => handleAnswer(0, index)}
                      disabled={showAnswer}
                      className={`p-4 rounded-lg text-left transition-colors ${getButtonStyle(
                        0,
                        index
                      )}`}
                    >
                      <span className="font-semibold mr-2">{index + 1}.</span>
                      {choice}
                    </button>
                  ))}
                </div>

                {showAnswer && (
                  <div className="mt-6 p-4 bg-blue-50 rounded-lg">
                    <h4 className="font-semibold text-blue-800 mb-2">
                      정답 및 해설
                    </h4>
                    <p className="text-blue-700">
                      <span className="font-bold">정답:</span>{" "}
                      {currentProblem.correct + 1}번 -{" "}
                      {currentProblem.choices[currentProblem.correct]}
                    </p>
                    <p className="text-blue-700 mt-2">
                      <span className="font-bold">해설:</span>{" "}
                      {currentProblem.explanation}
                    </p>
                  </div>
                )}
              </div>
            );
          }

          // 다중 문제인 경우
          if (
            currentProblem.questions &&
            Array.isArray(currentProblem.questions)
          ) {
            return (
              <div>
                {currentProblem.questions.map((questionObj, qIndex) => (
                  <div key={qIndex} className="mb-8">
                    <div className="mb-6">
                      <h4 className="text-lg font-semibold mb-2">
                        문제 {qIndex + 1}
                      </h4>
                      <p className="text-lg mb-4">
                        <span className="font-bold">
                          {questionObj.question}
                        </span>
                      </p>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4">
                      {questionObj.choices?.map((choice, cIndex) => (
                        <button
                          key={`${qIndex}-${cIndex}`}
                          onClick={() => handleAnswer(qIndex, cIndex)}
                          disabled={showAnswer}
                          className={`p-4 rounded-lg text-left transition-colors ${getButtonStyle(
                            qIndex,
                            cIndex
                          )}`}
                        >
                          <span className="font-semibold mr-2">
                            {cIndex + 1}.
                          </span>
                          {choice}
                        </button>
                      ))}
                    </div>

                    {showAnswer && (
                      <div className="mt-6 p-4 bg-blue-50 rounded-lg">
                        <h4 className="font-semibold text-blue-800 mb-2">
                          문제 {qIndex + 1} 정답 및 해설
                        </h4>
                        <p className="text-blue-700">
                          <span className="font-bold">정답:</span>{" "}
                          {questionObj.correct + 1}번 -{" "}
                          {questionObj.choices[questionObj.correct]}
                        </p>
                        <p className="text-blue-700 mt-2">
                          <span className="font-bold">해설:</span>{" "}
                          {questionObj.explanation}
                        </p>
                      </div>
                    )}
                  </div>
                ))}
              </div>
            );
          }

          return <div>문제 형식을 인식할 수 없습니다.</div>;
        };

        return (
          <div className="max-w-4xl mx-auto p-6 bg-white min-h-screen">
            {/* 헤더 */}
            <div className="text-center mb-8">
              <h1 className="text-3xl font-bold text-gray-800 mb-2">
                📖 JLPT N1 독해 문제 생성기 (고급)
              </h1>
              <p className="text-gray-600">
                Claude AI가 실시간으로 새로운 N1 독해 문제를 생성합니다!
              </p>
              <p className="text-sm text-purple-600 mt-1">
                ✨ 25가지 세부 유형 지원 • 가중치 기반 랜덤 선택 • 함정 요소
                포함
              </p>
            </div>

            {/* 상태 표시 */}
            <div className="grid md:grid-cols-3 gap-4 mb-6">
              <div className="bg-blue-50 p-4 rounded-lg text-center">
                <div className="text-lg font-semibold text-blue-800">
                  정답률:{" "}
                  {score.total > 0
                    ? Math.round((score.correct / score.total) * 100)
                    : 0}
                  % ({score.correct}/{score.total})
                </div>
              </div>
              <div className="bg-green-50 p-4 rounded-lg text-center">
                <div className="text-lg font-semibold text-green-800">
                  생성된 문제: {generationHistory.length}개
                </div>
              </div>
              <div className="bg-purple-50 p-4 rounded-lg text-center">
                <div className="text-sm font-semibold text-purple-800">
                  {apiStatus}
                </div>
              </div>
            </div>

            {/* 글 길이 선택 */}
            <div className="mb-6">
              <h3 className="text-lg font-semibold mb-3">글 길이 선택</h3>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 mb-4">
                {Object.entries(LENGTH_OPTIONS).map(([key, option]) => (
                  <button
                    key={key}
                    onClick={() => setSelectedLength(key)}
                    className={`p-4 rounded-lg border-2 transition-colors text-left ${
                      selectedLength === key
                        ? "border-blue-500 bg-blue-50 text-blue-800"
                        : "border-gray-200 bg-white text-gray-700 hover:bg-gray-50"
                    }`}
                  >
                    <div className="flex items-center justify-between mb-2">
                      <div className="flex items-center">
                        <span className="text-xl mr-2">{option.icon}</span>
                        <span className="font-semibold">{option.label}</span>
                      </div>
                      <span className="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded-full">
                        {option.subtypes}가지 유형
                      </span>
                    </div>
                    <div className="text-sm text-gray-600">
                      <div>{option.description}</div>
                      <div className="mt-1">
                        <span className="font-medium">길이:</span>{" "}
                        {option.characterRange}
                      </div>
                      <div>
                        <span className="font-medium">문제:</span>{" "}
                        {option.questionCount}
                      </div>
                    </div>
                  </button>
                ))}
              </div>
            </div>

            {/* 생성 방식 선택 */}
            <div className="mb-6">
              <h3 className="text-lg font-semibold mb-3">문제 생성 방식</h3>
              <div className="flex flex-wrap gap-2 mb-4">
                <button
                  onClick={() => setGenerationType("auto")}
                  className={`px-4 py-2 rounded-lg transition-colors ${
                    generationType === "auto"
                      ? "bg-blue-500 text-white"
                      : "bg-gray-100 text-gray-700 hover:bg-gray-200"
                  }`}
                >
                  🎲 자동 생성 (추천)
                </button>
                <button
                  onClick={() => setGenerationType("custom")}
                  className={`px-4 py-2 rounded-lg transition-colors ${
                    generationType === "custom"
                      ? "bg-blue-500 text-white"
                      : "bg-gray-100 text-gray-700 hover:bg-gray-200"
                  }`}
                >
                  ✏️ 커스텀 프롬프트
                </button>
              </div>

              {/* 커스텀 프롬프트 입력 */}
              {generationType === "custom" && (
                <div className="mt-4">
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    커스텀 프롬프트 입력
                  </label>
                  <textarea
                    value={customPrompt}
                    onChange={(e) => setCustomPrompt(e.target.value)}
                    placeholder="원하는 주제나 요구사항을 입력하세요..."
                    className="w-full h-32 p-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  />
                  <p className="text-xs text-gray-500 mt-1">
                    예: "환경 문제에 대한 논설문 형태의 독해 문제를
                    만들어주세요"
                  </p>
                  <p className="text-xs text-blue-600 mt-1">
                    선택한 글 길이 ({LENGTH_OPTIONS[selectedLength].label})와
                    랜덤 세부 유형이 자동으로 적용됩니다.
                  </p>
                </div>
              )}
            </div>

            {/* 문제 생성 버튼 */}
            <div className="text-center mb-8">
              <button
                onClick={generateProblem}
                disabled={
                  isGenerating ||
                  (generationType === "custom" && !customPrompt.trim())
                }
                className="bg-green-500 hover:bg-green-600 disabled:bg-gray-400 text-white px-8 py-3 rounded-lg text-lg font-semibold transition-colors flex items-center gap-2 mx-auto"
              >
                {isGenerating ? (
                  <>
                    <LoaderIcon />
                    AI가 독해 문제 생성 중...
                  </>
                ) : (
                  <>
                    🚀 {generationType === "auto" ? "자동 생성" : "커스텀 생성"}
                    <span className="text-sm font-normal">
                      ({LENGTH_OPTIONS[selectedLength].label})
                    </span>
                  </>
                )}
              </button>
              {isGenerating && (
                <p className="text-sm text-gray-600 mt-2">
                  {LENGTH_OPTIONS[selectedLength].label} 형태의 N1 독해 문제를
                  생성하고 있습니다. 잠시만 기다려주세요...
                </p>
              )}
            </div>

            {/* 문제 표시 */}
            {currentProblem && (
              <div className="bg-gray-50 p-6 rounded-lg mb-6">
                <div className="flex items-center justify-between mb-4">
                  <h3 className="text-xl font-semibold">
                    독해 문제 (
                    {LENGTH_OPTIONS[currentProblem.length || selectedLength]
                      ?.label || "표준"}
                    )
                  </h3>
                  <div className="text-sm text-gray-500 text-right">
                    <div>{currentProblem.source || "AI 생성"}</div>
                    <div>{currentProblem.displayedAt}</div>
                    {currentProblem.isBackup && (
                      <div className="text-yellow-600">⚠️ 백업 문제</div>
                    )}
                    {currentProblem.isError && (
                      <div className="text-red-600">🔴 오류 대체</div>
                    )}
                  </div>
                </div>

                {/* 세부 유형 정보 표시 */}
                {renderSubtypeInfo(currentProblem)}

                {/* 메타 정보 표시 */}
                {currentProblem.topic && (
                  <div className="mb-4 p-3 bg-blue-50 rounded border-l-4 border-blue-400">
                    <p className="text-sm text-blue-800">
                      <strong>주제:</strong>{" "}
                      {safeRenderText(currentProblem.topic)}
                    </p>
                    {currentProblem.genre && (
                      <p className="text-sm text-blue-800">
                        <strong>장르:</strong>{" "}
                        {safeRenderText(currentProblem.genre)}
                      </p>
                    )}
                    {currentProblem.lengthInfo && (
                      <p className="text-sm text-blue-800">
                        <strong>글 길이:</strong>{" "}
                        {currentProblem.lengthInfo.character_range ||
                          currentProblem.lengthInfo.characterRange}
                        <span className="ml-2">
                          <strong>문제 수:</strong>{" "}
                          {currentProblem.lengthInfo.question_count ||
                            currentProblem.lengthInfo.questionCount}
                        </span>
                      </p>
                    )}
                  </div>
                )}

                {/* 지문 - 비교형인 경우 두 개 지문 표시 */}
                {currentProblem.length === "comparative" &&
                currentProblem.passage1 &&
                currentProblem.passage2 ? (
                  <div className="mb-6 space-y-4">
                    <div className="p-4 bg-white rounded border">
                      <h4 className="font-semibold mb-2 text-gray-700">
                        지문 1
                      </h4>
                      <p className="text-gray-800 leading-relaxed text-lg">
                        {currentProblem.passage1}
                      </p>
                    </div>
                    <div className="p-4 bg-white rounded border">
                      <h4 className="font-semibold mb-2 text-gray-700">
                        지문 2
                      </h4>
                      <p className="text-gray-800 leading-relaxed text-lg">
                        {currentProblem.passage2}
                      </p>
                    </div>
                  </div>
                ) : (
                  <div className="mb-6 p-4 bg-white rounded border">
                    <p className="text-gray-800 leading-relaxed text-lg">
                      {currentProblem.passage}
                    </p>
                  </div>
                )}

                {/* 문제 렌더링 */}
                {renderProblem()}
              </div>
            )}

            {/* 최근 생성 이력 */}
            {generationHistory.length > 0 && (
              <div className="mt-8">
                <h3 className="text-lg font-semibold mb-3">
                  최근 생성된 문제들
                </h3>
                <div className="grid md:grid-cols-2 gap-3">
                  {generationHistory.slice(0, 4).map((problem) => (
                    <div
                      key={problem.id}
                      className="bg-gray-100 p-3 rounded text-sm"
                    >
                      <div className="flex justify-between items-center mb-1">
                        <div className="flex items-center gap-2">
                          <span className="font-semibold">
                            독해 (
                            {LENGTH_OPTIONS[problem.length]?.label || "표준"})
                          </span>
                          {problem.subtypeInfo?.definition?.label && (
                            <span className="subtype-badge text-xs">
                              {problem.subtypeInfo.definition.label}
                            </span>
                          )}
                        </div>
                        <span className="text-gray-500">{problem.source}</span>
                      </div>
                      <p className="text-gray-700 truncate">
                        {safeRenderText(problem.topic) ||
                          problem.passage?.substring(0, 30)}
                        ...
                      </p>
                      <div className="flex justify-between items-center mt-1">
                        <p className="text-xs text-gray-500">
                          {problem.displayedAt}
                        </p>
                        {problem.trapDifficulty && (
                          <span
                            className={`text-xs px-1 py-0.5 rounded ${
                              problem.trapDifficulty === "고난이도"
                                ? "bg-red-100 text-red-600"
                                : "bg-green-100 text-green-600"
                            }`}
                          >
                            {problem.trapDifficulty}
                          </span>
                        )}
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* 디버그 정보 (개발 모드일 때만) */}
            {debugInfo.length > 0 && (
              <div className="mt-8 bg-yellow-50 border-l-4 border-yellow-400 p-4">
                <h3 className="text-lg font-semibold mb-2">🐛 디버그 정보</h3>
                <div className="max-h-40 overflow-y-auto text-sm">
                  {debugInfo.map((log, index) => (
                    <div key={index} className="mb-2 font-mono">
                      <span className="text-gray-500">[{log.timestamp}]</span>{" "}
                      {log.message}
                      {log.data && (
                        <pre className="mt-1 text-xs bg-gray-100 p-1 rounded overflow-x-auto max-h-20">
                          {log.data}
                        </pre>
                      )}
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* 푸터 */}
            <div className="mt-12 text-center text-gray-500 text-sm">
              <p>JLPT N1 대비용 독해 문제 생성기 (고급 버전)</p>
              <p>25가지 세부 유형 • 가중치 랜덤 • N1 함정 요소 포함</p>
              <p className="mt-1">
                실제 시험과는 다를 수 있으니 참고용으로만 사용해주세요.
              </p>
            </div>
          </div>
        );
      };

      // React 18 방식으로 앱 렌더링
      const root = createRoot(document.getElementById("root"));
      root.render(<ReadingGenerator />);
    </script>
  </body>
</html>
