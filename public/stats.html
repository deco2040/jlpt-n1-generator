<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JLPT N1 í•™ìŠµ í†µê³„</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Noto Sans", Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
        background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
        min-height: 100vh;
      }

      .fade-in {
        animation: fadeIn 0.5s ease-in;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .stat-card {
        transition: all 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }

      .progress-bar {
        height: 8px;
        background-color: #e5e7eb;
        border-radius: 4px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #10b981, #34d399);
        border-radius: 4px;
        transition: width 0.3s ease;
      }

      .history-item {
        transition: all 0.2s ease;
      }

      .history-item:hover {
        background-color: #f8fafc;
        transform: translateX(4px);
      }

      .correct-badge {
        background: #dcfce7;
        color: #15803d;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
      }

      .incorrect-badge {
        background: #fef2f2;
        color: #dc2626;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
      }

      .type-badge {
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
      }

      .type-reading {
        background: #dbeafe;
        color: #1e40af;
      }
      .type-kanji {
        background: #fce7f3;
        color: #be185d;
      }
      .type-grammar {
        background: #dcfce7;
        color: #15803d;
      }
      .type-vocabulary {
        background: #f0f9ff;
        color: #0369a1;
      }

      .chart-container {
        position: relative;
        height: 200px;
        background: white;
        border-radius: 8px;
        padding: 20px;
        display: flex;
        align-items: end;
        justify-content: space-around;
      }

      .chart-bar {
        width: 40px;
        background: linear-gradient(180deg, #667eea, #764ba2);
        border-radius: 4px 4px 0 0;
        display: flex;
        align-items: end;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 0.75rem;
        padding: 4px 0;
        transition: all 0.3s ease;
      }

      .chart-bar:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      @media (max-width: 768px) {
        .grid {
          grid-template-columns: 1fr;
        }
        .md\\:grid-cols-2 {
          grid-template-columns: 1fr;
        }
        .md\\:grid-cols-4 {
          grid-template-columns: repeat(2, 1fr);
        }
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useMemo } = React;
      const { createRoot } = ReactDOM;

      const StatsPage = () => {
        const [allStats, setAllStats] = useState({
          reading: { correct: 0, total: 0, streak: 0, history: [] },
          kanji: { correct: 0, total: 0, streak: 0, history: [] },
          grammar: { correct: 0, total: 0, streak: 0, history: [] },
          vocabulary: { correct: 0, total: 0, streak: 0, history: [] },
          mixed: { correct: 0, total: 0, streak: 0, history: [], byType: {} },
        });

        const [selectedPeriod, setSelectedPeriod] = useState("all"); // all, week, month
        const [selectedType, setSelectedType] = useState("all"); // all, reading, kanji, grammar, vocabulary

        // ë°ì´í„° ë¡œë”©
        useEffect(() => {
          const loadStats = () => {
            const stats = {};

            // ê° ìœ í˜•ë³„ ë°ì´í„° ë¡œë”©
            ["reading", "kanji", "grammar", "vocabulary", "mixed"].forEach(
              (type) => {
                const score = localStorage.getItem(
                  `jlpt-${
                    type === "mixed"
                      ? "mixed"
                      : type === "reading"
                      ? "reading"
                      : type === "kanji"
                      ? "kanji"
                      : type === "grammar"
                      ? "grammar"
                      : "vocab"
                  }-score`
                );
                const streak = localStorage.getItem(
                  `jlpt-${
                    type === "mixed"
                      ? "mixed"
                      : type === "reading"
                      ? "reading"
                      : type === "kanji"
                      ? "kanji"
                      : type === "grammar"
                      ? "grammar"
                      : "vocab"
                  }-streak`
                );
                const history = localStorage.getItem(
                  `jlpt-${
                    type === "mixed"
                      ? "mixed"
                      : type === "reading"
                      ? "reading"
                      : type === "kanji"
                      ? "kanji"
                      : type === "grammar"
                      ? "grammar"
                      : "vocab"
                  }-history`
                );

                stats[type] = {
                  correct: score ? JSON.parse(score).correct : 0,
                  total: score ? JSON.parse(score).total : 0,
                  streak: streak ? parseInt(streak) : 0,
                  history: history ? JSON.parse(history) : [],
                  byType:
                    score && JSON.parse(score).byType
                      ? JSON.parse(score).byType
                      : {},
                };
              }
            );

            setAllStats(stats);
          };

          loadStats();

          // ìŠ¤í† ë¦¬ì§€ ë³€ê²½ ê°ì§€
          const handleStorageChange = () => loadStats();
          window.addEventListener("storage", handleStorageChange);

          return () =>
            window.removeEventListener("storage", handleStorageChange);
        }, []);

        // ì „ì²´ í†µê³„ ê³„ì‚°
        const totalStats = useMemo(() => {
          const total = Object.values(allStats).reduce(
            (acc, stat) => ({
              correct: acc.correct + stat.correct,
              total: acc.total + stat.total,
            }),
            { correct: 0, total: 0 }
          );

          const maxStreak = Math.max(
            ...Object.values(allStats).map((stat) => stat.streak)
          );

          return {
            ...total,
            accuracy:
              total.total > 0
                ? Math.round((total.correct / total.total) * 100)
                : 0,
            maxStreak,
          };
        }, [allStats]);

        // ê¸°ê°„ë³„ í•„í„°ë§ëœ íˆìŠ¤í† ë¦¬
        const filteredHistory = useMemo(() => {
          const now = new Date();
          const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
          const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);

          let allHistory = [];

          if (selectedType === "all") {
            Object.entries(allStats).forEach(([type, stats]) => {
              stats.history.forEach((item) => {
                allHistory.push({ ...item, sourceType: type });
              });
            });
          } else {
            allHistory =
              allStats[selectedType]?.history.map((item) => ({
                ...item,
                sourceType: selectedType,
              })) || [];
          }

          if (selectedPeriod === "week") {
            allHistory = allHistory.filter(
              (item) => new Date(item.timestamp) >= weekAgo
            );
          } else if (selectedPeriod === "month") {
            allHistory = allHistory.filter(
              (item) => new Date(item.timestamp) >= monthAgo
            );
          }

          return allHistory.sort(
            (a, b) => new Date(b.timestamp) - new Date(a.timestamp)
          );
        }, [allStats, selectedPeriod, selectedType]);

        // ì¼ë³„ í•™ìŠµ í˜„í™©
        const dailyStats = useMemo(() => {
          const last7Days = Array.from({ length: 7 }, (_, i) => {
            const date = new Date();
            date.setDate(date.getDate() - i);
            return date.toISOString().split("T")[0];
          }).reverse();

          return last7Days.map((date) => {
            const dayHistory = filteredHistory.filter((item) =>
              item.timestamp.startsWith(date)
            );

            return {
              date,
              total: dayHistory.length,
              correct: dayHistory.filter((item) => item.isCorrect).length,
              accuracy:
                dayHistory.length > 0
                  ? Math.round(
                      (dayHistory.filter((item) => item.isCorrect).length /
                        dayHistory.length) *
                        100
                    )
                  : 0,
            };
          });
        }, [filteredHistory]);

        // í†µê³„ ì´ˆê¸°í™”
        const resetAllStats = () => {
          if (
            confirm(
              "ëª¨ë“  í•™ìŠµ ê¸°ë¡ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
            )
          ) {
            ["reading", "kanji", "grammar", "vocab", "mixed"].forEach(
              (type) => {
                localStorage.removeItem(`jlpt-${type}-score`);
                localStorage.removeItem(`jlpt-${type}-streak`);
                localStorage.removeItem(`jlpt-${type}-history`);
              }
            );

            setAllStats({
              reading: { correct: 0, total: 0, streak: 0, history: [] },
              kanji: { correct: 0, total: 0, streak: 0, history: [] },
              grammar: { correct: 0, total: 0, streak: 0, history: [] },
              vocabulary: { correct: 0, total: 0, streak: 0, history: [] },
              mixed: {
                correct: 0,
                total: 0,
                streak: 0,
                history: [],
                byType: {},
              },
            });
          }
        };

        // ë°ì´í„° ë‚´ë³´ë‚´ê¸°
        const exportData = () => {
          const dataStr = JSON.stringify(allStats, null, 2);
          const dataBlob = new Blob([dataStr], { type: "application/json" });
          const url = URL.createObjectURL(dataBlob);
          const link = document.createElement("a");
          link.href = url;
          link.download = `jlpt-n1-stats-${
            new Date().toISOString().split("T")[0]
          }.json`;
          link.click();
        };

        return (
          <div className="max-w-7xl mx-auto p-6 bg-white min-h-screen">
            {/* í—¤ë” */}
            <div className="text-center mb-8">
              <h1 className="text-3xl font-bold text-gray-800 mb-2">
                ğŸ“Š JLPT N1 í•™ìŠµ í†µê³„
              </h1>
              <p className="text-gray-600">
                ì „ì²´ í•™ìŠµ í˜„í™©ê³¼ ìƒì„¸ ë¶„ì„ì„ í™•ì¸í•˜ì„¸ìš”
              </p>
              <div className="mt-4 flex justify-center gap-4 text-sm flex-wrap">
                <a
                  href="index.html"
                  className="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600 transition-colors"
                >
                  ğŸ“– ë…í•´ ë¬¸ì œ
                </a>
                <a
                  href="kanji-generator.html"
                  className="bg-pink-500 text-white px-4 py-2 rounded hover:bg-pink-600 transition-colors"
                >
                  ğŸ“ í•œì ë¬¸ì œ
                </a>
                <a
                  href="grammar-generator.html"
                  className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition-colors"
                >
                  ğŸ“š ë¬¸ë²• ë¬¸ì œ
                </a>
                <a
                  href="mixed-generator.html"
                  className="bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600 transition-colors"
                >
                  ğŸ¯ í†µí•© ë¬¸ì œ
                </a>
              </div>
            </div>

            {/* ì „ì²´ ìš”ì•½ í†µê³„ */}
            <div className="grid md:grid-cols-4 gap-6 mb-8">
              <div className="stat-card bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-lg border">
                <div className="flex items-center justify-between mb-4">
                  <h3 className="text-lg font-semibold text-blue-800">
                    ì „ì²´ ì •ë‹µë¥ 
                  </h3>
                  <div className="text-3xl">ğŸ“ˆ</div>
                </div>
                <div className="text-3xl font-bold text-blue-600 mb-2">
                  {totalStats.accuracy}%
                </div>
                <div className="text-sm text-blue-500">
                  {totalStats.correct}/{totalStats.total} ë¬¸ì œ
                </div>
                <div className="progress-bar mt-3">
                  <div
                    className="progress-fill bg-blue-500"
                    style={{ width: `${totalStats.accuracy}%` }}
                  ></div>
                </div>
              </div>

              <div className="stat-card bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-lg border">
                <div className="flex items-center justify-between mb-4">
                  <h3 className="text-lg font-semibold text-green-800">
                    ìµœê³  ì—°ì† ì •ë‹µ
                  </h3>
                  <div className="text-3xl">ğŸ”¥</div>
                </div>
                <div className="text-3xl font-bold text-green-600 mb-2">
                  {totalStats.maxStreak}íšŒ
                </div>
                <div className="text-sm text-green-500">ê°œì¸ ìµœê³  ê¸°ë¡</div>
              </div>

              <div className="stat-card bg-gradient-to-br from-purple-50 to-purple-100 p-6 rounded-lg border">
                <div className="flex items-center justify-between mb-4">
                  <h3 className="text-lg font-semibold text-purple-800">
                    ì´ í•™ìŠµ ë¬¸ì œ
                  </h3>
                  <div className="text-3xl">ğŸ“š</div>
                </div>
                <div className="text-3xl font-bold text-purple-600 mb-2">
                  {totalStats.total}ê°œ
                </div>
                <div className="text-sm text-purple-500">ëˆ„ì  í•™ìŠµëŸ‰</div>
              </div>

              <div className="stat-card bg-gradient-to-br from-orange-50 to-orange-100 p-6 rounded-lg border">
                <div className="flex items-center justify-between mb-4">
                  <h3 className="text-lg font-semibold text-orange-800">
                    í•™ìŠµ ì¼ìˆ˜
                  </h3>
                  <div className="text-3xl">ğŸ“…</div>
                </div>
                <div className="text-3xl font-bold text-orange-600 mb-2">
                  {Math.ceil(totalStats.total / 10)}ì¼
                </div>
                <div className="text-sm text-orange-500">ì˜ˆìƒ í•™ìŠµ ê¸°ê°„</div>
              </div>
            </div>

            {/* ìœ í˜•ë³„ ìƒì„¸ í†µê³„ */}
            <div className="mb-8">
              <h2 className="text-2xl font-bold text-gray-800 mb-6">
                ğŸ¯ ìœ í˜•ë³„ ìƒì„¸ ë¶„ì„
              </h2>
              <div className="grid md:grid-cols-2 lg:grid-cols-5 gap-4">
                {Object.entries(allStats).map(([type, stats]) => {
                  const accuracy =
                    stats.total > 0
                      ? Math.round((stats.correct / stats.total) * 100)
                      : 0;
                  const typeNames = {
                    reading: "ğŸ“– ë…í•´",
                    kanji: "ğŸ“ í•œì",
                    grammar: "ğŸ“š ë¬¸ë²•",
                    vocabulary: "ğŸ’­ ì–´íœ˜",
                    mixed: "ğŸ¯ í†µí•©",
                  };

                  return (
                    <div
                      key={type}
                      className="stat-card bg-white p-4 rounded-lg border hover:shadow-lg"
                    >
                      <h3 className="font-semibold text-gray-800 mb-3">
                        {typeNames[type]}
                      </h3>
                      <div className="text-2xl font-bold text-gray-700 mb-2">
                        {accuracy}%
                      </div>
                      <div className="text-sm text-gray-500 mb-3">
                        {stats.correct}/{stats.total}
                      </div>
                      <div className="progress-bar">
                        <div
                          className="progress-fill"
                          style={{ width: `${accuracy}%` }}
                        ></div>
                      </div>
                      <div className="text-xs text-gray-400 mt-2">
                        ì—°ì†: {stats.streak}íšŒ
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>

            {/* ì¼ë³„ í•™ìŠµ í˜„í™© ì°¨íŠ¸ */}
            <div className="mb-8">
              <h2 className="text-2xl font-bold text-gray-800 mb-6">
                ğŸ“ˆ ìµœê·¼ 7ì¼ í•™ìŠµ í˜„í™©
              </h2>
              <div className="bg-white p-6 rounded-lg border">
                <div className="chart-container">
                  {dailyStats.map((day, index) => (
                    <div key={index} className="flex flex-col items-center">
                      <div
                        className="chart-bar"
                        style={{
                          height: `${Math.max(day.total * 10, 20)}px`,
                          background:
                            day.total > 0
                              ? `linear-gradient(180deg, hsl(${
                                  day.accuracy * 1.2
                                }, 70%, 50%), hsl(${
                                  day.accuracy * 1.2
                                }, 70%, 60%))`
                              : "#e5e7eb",
                        }}
                        title={`${day.date}: ${day.total}ë¬¸ì œ (${day.accuracy}%)`}
                      >
                        {day.total}
                      </div>
                      <div className="text-xs text-gray-500 mt-2">
                        {new Date(day.date).toLocaleDateString("ko-KR", {
                          month: "short",
                          day: "numeric",
                        })}
                      </div>
                    </div>
                  ))}
                </div>
                <div className="text-center text-sm text-gray-500 mt-4">
                  ë§‰ëŒ€ ë†’ì´: ë¬¸ì œ ìˆ˜ | ë§‰ëŒ€ ìƒ‰ìƒ: ì •ë‹µë¥ 
                </div>
              </div>
            </div>

            {/* í•„í„°ë§ ì˜µì…˜ */}
            <div className="mb-6">
              <div className="flex flex-wrap gap-4 items-center justify-between">
                <h2 className="text-2xl font-bold text-gray-800">
                  ğŸ•’ í•™ìŠµ ê¸°ë¡
                </h2>
                <div className="flex gap-4">
                  <select
                    value={selectedPeriod}
                    onChange={(e) => setSelectedPeriod(e.target.value)}
                    className="px-3 py-2 border rounded-lg"
                  >
                    <option value="all">ì „ì²´ ê¸°ê°„</option>
                    <option value="week">ìµœê·¼ 1ì£¼ì¼</option>
                    <option value="month">ìµœê·¼ 1ê°œì›”</option>
                  </select>
                  <select
                    value={selectedType}
                    onChange={(e) => setSelectedType(e.target.value)}
                    className="px-3 py-2 border rounded-lg"
                  >
                    <option value="all">ëª¨ë“  ìœ í˜•</option>
                    <option value="reading">ë…í•´</option>
                    <option value="kanji">í•œì</option>
                    <option value="grammar">ë¬¸ë²•</option>
                    <option value="vocabulary">ì–´íœ˜</option>
                    <option value="mixed">í†µí•©</option>
                  </select>
                </div>
              </div>
            </div>

            {/* í•™ìŠµ ê¸°ë¡ ëª©ë¡ */}
            <div className="bg-white rounded-lg border mb-8">
              <div className="p-4 border-b bg-gray-50">
                <div className="flex justify-between items-center">
                  <span className="font-semibold text-gray-700">
                    ì´ {filteredHistory.length}ê°œ ê¸°ë¡
                  </span>
                  <div className="text-sm text-gray-500">
                    ì •ë‹µë¥ :{" "}
                    {filteredHistory.length > 0
                      ? Math.round(
                          (filteredHistory.filter((item) => item.isCorrect)
                            .length /
                            filteredHistory.length) *
                            100
                        )
                      : 0}
                    %
                  </div>
                </div>
              </div>

              <div className="max-h-96 overflow-y-auto">
                {filteredHistory.length === 0 ? (
                  <div className="p-8 text-center text-gray-500">
                    <div className="text-4xl mb-4">ğŸ“­</div>
                    <p>ì„ íƒí•œ ì¡°ê±´ì— í•´ë‹¹í•˜ëŠ” í•™ìŠµ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                  </div>
                ) : (
                  filteredHistory.slice(0, 50).map((item, index) => (
                    <div
                      key={index}
                      className="history-item p-4 border-b hover:bg-gray-50"
                    >
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <span
                            className={
                              item.isCorrect
                                ? "correct-badge"
                                : "incorrect-badge"
                            }
                          >
                            {item.isCorrect ? "âœ“ ì •ë‹µ" : "âœ— ì˜¤ë‹µ"}
                          </span>
                          <span
                            className={`type-badge type-${
                              item.type || item.sourceType
                            }`}
                          >
                            {item.type === "reading" ||
                            item.sourceType === "reading"
                              ? "ë…í•´"
                              : item.type === "kanji" ||
                                item.sourceType === "kanji"
                              ? "í•œì"
                              : item.type === "grammar" ||
                                item.sourceType === "grammar"
                              ? "ë¬¸ë²•"
                              : item.type === "vocabulary" ||
                                item.sourceType === "vocabulary"
                              ? "ì–´íœ˜"
                              : "í†µí•©"}
                          </span>
                          <span className="text-sm text-gray-600 truncate max-w-md">
                            {item.question?.substring(0, 50)}...
                          </span>
                        </div>
                        <div className="text-xs text-gray-400">
                          {new Date(item.timestamp).toLocaleString("ko-KR")}
                        </div>
                      </div>
                    </div>
                  ))
                )}
              </div>
            </div>

            {/* ê´€ë¦¬ ë„êµ¬ */}
            <div className="bg-gray-50 p-6 rounded-lg border">
              <h3 className="text-lg font-semibold text-gray-800 mb-4">
                ğŸ› ï¸ ë°ì´í„° ê´€ë¦¬
              </h3>
              <div className="flex flex-wrap gap-4">
                <button
                  onClick={exportData}
                  className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"
                >
                  ğŸ“¤ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
                </button>
                <button
                  onClick={resetAllStats}
                  className="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors"
                >
                  ğŸ—‘ï¸ ëª¨ë“  ê¸°ë¡ ì‚­ì œ
                </button>
              </div>
              <p className="text-sm text-gray-500 mt-3">
                ğŸ’¡ ë°ì´í„°ë¥¼ ì•ˆì „í•˜ê²Œ ë°±ì—…í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚­ì œëœ
                ë°ì´í„°ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìœ¼ë‹ˆ ì£¼ì˜í•˜ì„¸ìš”.
              </p>
            </div>

            {/* í‘¸í„° */}
            <div className="mt-12 text-center text-gray-500 text-sm">
              <p>JLPT N1 ëŒ€ë¹„ìš© í•™ìŠµ í†µê³„ ëŒ€ì‹œë³´ë“œ</p>
              <p>ê¾¸ì¤€í•œ í•™ìŠµìœ¼ë¡œ ëª©í‘œë¥¼ ë‹¬ì„±í•˜ì„¸ìš”! ğŸ¯</p>
            </div>
          </div>
        );
      };

      // React 18 ë°©ì‹ìœ¼ë¡œ ì•± ë Œë”ë§
      const root = createRoot(document.getElementById("root"));
      root.render(<StatsPage />);
    </script>
  </body>
</html>
