<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JLPT N1 ë…í•´ ë¬¸ì œ ìƒì„±ê¸° (í™”ì ì‹œìŠ¤í…œ í†µí•©)</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <meta name="theme-color" content="#3B82F6" />
    <meta
      name="description"
      content="Claude AIê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ìƒˆë¡œìš´ JLPT N1 ë…í•´ ë¬¸ì œë¥¼ ìƒì„±í•©ë‹ˆë‹¤ - í™”ì ì‹œìŠ¤í…œ í†µí•©ìœ¼ë¡œ ë”ìš± í˜„ì‹¤ì ì¸ ë¬¸ì œ"
    />

    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ­</text></svg>"
    />

    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
          sans-serif;
      }
      .speaker-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        font-size: 0.75rem;
        font-weight: 600;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 9999px;
        margin-right: 0.5rem;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
      }
      .speaker-category {
        display: inline-block;
        padding: 0.2rem 0.5rem;
        font-size: 0.7rem;
        font-weight: 500;
        background-color: #f3e8ff;
        color: #7c3aed;
        border-radius: 9999px;
        margin-left: 0.5rem;
      }
      .speaker-detail {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 1rem;
        color: white;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      }
      .speaker-detail h4 {
        margin: 0 0 0.5rem 0;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .speaker-detail p {
        margin: 0;
        opacity: 0.9;
        font-size: 0.875rem;
        line-height: 1.4;
      }
      .persona-icon {
        width: 24px;
        height: 24px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;
      const { createRoot } = ReactDOM;

      // ë¡œë”© ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸
      const LoaderIcon = () => (
        <svg
          className="animate-spin -ml-1 mr-3 h-5 w-5 text-white"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
        >
          <circle
            className="opacity-25"
            cx="12"
            cy="12"
            r="10"
            stroke="currentColor"
            strokeWidth="4"
          ></circle>
          <path
            className="opacity-75"
            fill="currentColor"
            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
          ></path>
        </svg>
      );

      // í™”ì ì •ë³´ í‘œì‹œ ì»´í¬ë„ŒíŠ¸
      const SpeakerInfoCard = ({ speaker, speakerInfo, show = true }) => {
        if (!show || (!speaker && !speakerInfo)) return null;

        const displaySpeaker = speakerInfo || speaker;

        return (
          <div className="speaker-detail">
            <h4>
              <div className="persona-icon">ğŸ­</div>
              í™”ì: {displaySpeaker.label || "ë¯¸ì§€ì •"}
              {displaySpeaker.category && (
                <span className="speaker-category">
                  {displaySpeaker.category}
                </span>
              )}
            </h4>
            <p>
              <strong>íŠ¹ì„±:</strong>{" "}
              {displaySpeaker.writing_style ||
                displaySpeaker.description ||
                "ì¼ë°˜ì ì¸ ê´€ì "}
            </p>
            {displaySpeaker.tone_characteristics && (
              <p>
                <strong>ì–´ì¡°:</strong> {displaySpeaker.tone_characteristics}
              </p>
            )}
            {displaySpeaker.age_range && (
              <p>
                <strong>ì—°ë ¹ëŒ€:</strong> {displaySpeaker.age_range}
              </p>
            )}
          </div>
        );
      };

      const ReadingGenerator = () => {
        const [currentProblem, setCurrentProblem] = useState(null);
        const [customPrompt, setCustomPrompt] = useState("");
        const [generationType, setGenerationType] = useState("auto");
        const [selectedLength, setSelectedLength] = useState("medium");
        const [showAnswer, setShowAnswer] = useState(false);
        const [score, setScore] = useState({ correct: 0, total: 0 });
        const [isGenerating, setIsGenerating] = useState(false);
        const [generationHistory, setGenerationHistory] = useState([]);
        const [apiStatus, setApiStatus] = useState("í™•ì¸ ì¤‘...");
        const [showSpeakerInfo, setShowSpeakerInfo] = useState(true);

        // ê¸¸ì´ ì˜µì…˜
        const lengthOptions = {
          short: {
            label: "ë‹¨ë¬¸ (çŸ­æ–‡)",
            description: "ì§§ì€ ì§€ë¬¸ìœ¼ë¡œ í•µì‹¬ ë‚´ìš© íŒŒì•…",
            characterRange: "200~400ì",
            questionCount: "1ë¬¸ì œ",
            icon: "ğŸ“„",
            estimatedTime: 3,
          },
          medium: {
            label: "ì¤‘ë¬¸ (ä¸­æ–‡)",
            description: "ì ë‹¹í•œ ê¸¸ì´ì˜ ë…¼ì„¤ë¬¸ì´ë‚˜ ì„¤ëª…ë¬¸",
            characterRange: "450~700ì",
            questionCount: "1~2ë¬¸ì œ",
            icon: "ğŸ“ƒ",
            estimatedTime: 7,
          },
          long: {
            label: "ì¥ë¬¸ (é•·æ–‡)",
            description: "ê¸´ ì§€ë¬¸ìœ¼ë¡œ ì‹¬í™”ëœ ë…í•´ë ¥ í‰ê°€",
            characterRange: "800~1200ì",
            questionCount: "3~5ë¬¸ì œ",
            icon: "ğŸ“‘",
            estimatedTime: 15,
          },
          comparative: {
            label: "ì¢…í•© ì´í•´ (çµ±åˆç†è§£)",
            description: "ë‘ ê°œì˜ ì§€ë¬¸ì„ ë¹„êµ ë¶„ì„",
            characterRange: "ê° 300~500ì (ì´ 2ê°œ ì§€ë¬¸)",
            questionCount: "2~3ë¬¸ì œ",
            icon: "ğŸ“Š",
            estimatedTime: 12,
          },
          practical: {
            label: "ì •ë³´ ê²€ìƒ‰ (æƒ…å ±æ¤œç´¢)",
            description: "ì‹¤ìš©ë¬¸ì„œë‚˜ ìë£Œë¥¼ í™œìš©í•œ ì •ë³´ ê²€ìƒ‰",
            characterRange: "600~1200ì",
            questionCount: "2~4ë¬¸ì œ",
            icon: "ğŸ“‹",
            estimatedTime: 10,
          },
        };

        // API ìƒíƒœ í™•ì¸
        const checkAPIStatus = async () => {
          try {
            await new Promise((resolve) => setTimeout(resolve, 1000));
            setApiStatus("ğŸŸ¢ ë…í•´ ìƒì„± API ì¤€ë¹„ë¨ (í™”ì ì‹œìŠ¤í…œ í†µí•©)");
          } catch (error) {
            setApiStatus("ğŸ”´ API ì—°ê²° ì‹¤íŒ¨");
          }
        };

        useEffect(() => {
          checkAPIStatus();
        }, []);

        // ë¬¸ì œ ìƒì„± í•¨ìˆ˜
        const generateProblem = async () => {
          setIsGenerating(true);
          setCurrentProblem(null);
          setShowAnswer(false);

          try {
            const requestData =
              generationType === "custom" && customPrompt.trim()
                ? {
                    type: "custom",
                    prompt: customPrompt.trim(),
                    length: selectedLength,
                  }
                : {
                    type: "generate",
                    length: selectedLength,
                  };

            const response = await fetch("/api/generate-reading", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(requestData),
            });

            if (!response.ok) {
              throw new Error(
                `HTTP ${response.status}: ${response.statusText}`
              );
            }

            const data = await response.json();

            if (data.success) {
              const problem = {
                ...data.problem,
                id: Date.now(),
                displayedAt: new Date().toLocaleString("ko-KR"),
              };

              setCurrentProblem(problem);
              setGenerationHistory((prev) => [problem, ...prev.slice(0, 9)]);

              if (generationType === "custom") {
                setCustomPrompt("");
              }
            } else {
              const problem = {
                ...data.problem,
                id: Date.now(),
                displayedAt: new Date().toLocaleString("ko-KR"),
                isBackup: true,
              };

              setCurrentProblem(problem);
            }
          } catch (error) {
            console.error("ìƒì„± ì‹¤íŒ¨:", error);

            const fallbackProblem = {
              type: "reading",
              length: selectedLength,
              topic: "ê¸°ìˆ ê³¼ ì‚¬íšŒ ë³€í™”",
              passage:
                "ç¾ä»£ç¤¾ä¼šã«ãŠã„ã¦æŠ€è¡“ã®é€²æ­©ã¯æˆ‘ã€…ã®ç”Ÿæ´»ã‚’å¤§ããå¤‰ãˆã¦ã„ã‚‹ã€‚ç‰¹ã«ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®æ™®åŠã«ã‚ˆã‚Šã€ã„ã¤ã§ã‚‚ã©ã“ã§ã‚‚æƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚ã—ã‹ã—ã€ã“ã®ä¾¿åˆ©ã•ã®ä¸€æ–¹ã§ã€äººã€…ã®é›†ä¸­åŠ›ä½ä¸‹ã‚„å¯¾é¢ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ¸›å°‘ã¨ã„ã£ãŸå•é¡Œã‚‚æŒ‡æ‘˜ã•ã‚Œã¦ã„ã‚‹ã€‚",
              question:
                "ã“ã®æ–‡ç« ã§è¿°ã¹ã‚‰ã‚Œã¦ã„ã‚‹æŠ€è¡“ã®é€²æ­©ã«ã¤ã„ã¦æœ€ã‚‚é©åˆ‡ãªã‚‚ã®ã¯ã©ã‚Œã§ã™ã‹ã€‚",
              choices: [
                "ä¾¿åˆ©ã•ã¨å•é¡Œã®ä¸¡é¢ãŒã‚ã‚‹ã“ã¨ã‚’ç¤ºã—ã¦ã„ã‚‹",
                "å®Œå…¨ã«è‚¯å®šçš„ãªå½±éŸ¿ã—ã‹ãªã„ã¨è¿°ã¹ã¦ã„ã‚‹",
                "æŠ€è¡“ã®é€²æ­©ãŒé…ã„ã“ã¨ã‚’æ‰¹åˆ¤ã—ã¦ã„ã‚‹",
                "ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ä»¥å¤–ã®æŠ€è¡“ã«ã¤ã„ã¦è«–ã˜ã¦ã„ã‚‹",
              ],
              correct: 0,
              explanation:
                "ë¬¸ì¥ì—ì„œëŠ” ê¸°ìˆ  ì§„ë³´ì˜ í¸ë¦¬í•¨ê³¼ í•¨ê»˜ ì§‘ì¤‘ë ¥ ì €í•˜, ëŒ€ë©´ ì†Œí†µ ê°ì†Œ ë“±ì˜ ë¬¸ì œì ë„ í•¨ê»˜ ì–¸ê¸‰í•˜ê³  ìˆìŠµë‹ˆë‹¤.",
              source: "í´ë¼ì´ì–¸íŠ¸ ë°±ì—…",
              id: Date.now(),
              displayedAt: new Date().toLocaleString("ko-KR"),
              isError: true,
              speakerInfo: {
                label: "ì‚¬íšŒ ë…¼í‰ê°€",
                writing_style: "ê· í˜•ì¡íŒ, ë‹¤ê°ì , ê±´ì„¤ì ",
                category: "intellectuals",
              },
            };

            setCurrentProblem(fallbackProblem);
            alert(`ë¬¸ì œ ìƒì„± ì‹¤íŒ¨: ${error.message}\në°±ì—… ë¬¸ì œë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.`);
          }

          setIsGenerating(false);
        };

        // ë‹µì•ˆ ì²˜ë¦¬ í•¨ìˆ˜
        const handleAnswer = (questionIndex, selectedIndex) => {
          if (!currentProblem) return;

          let isCorrect = false;

          if (typeof currentProblem.correct === "number") {
            isCorrect = selectedIndex === currentProblem.correct;
          } else if (
            currentProblem.questions &&
            currentProblem.questions[questionIndex]
          ) {
            isCorrect =
              selectedIndex === currentProblem.questions[questionIndex].correct;
          }

          if (isCorrect) {
            setScore((prev) => ({
              correct: prev.correct + 1,
              total: prev.total + 1,
            }));
          } else {
            setScore((prev) => ({ ...prev, total: prev.total + 1 }));
          }
          setShowAnswer(true);
        };

        // ë‹µì•ˆ ìŠ¤íƒ€ì¼ë§ í•¨ìˆ˜
        const getButtonStyle = (questionIndex, choiceIndex) => {
          if (!showAnswer) {
            return "bg-white hover:bg-blue-50 border border-gray-300 text-gray-700";
          }

          let correctIndex;
          if (typeof currentProblem.correct === "number") {
            correctIndex = currentProblem.correct;
          } else if (
            currentProblem.questions &&
            currentProblem.questions[questionIndex]
          ) {
            correctIndex = currentProblem.questions[questionIndex].correct;
          }

          if (choiceIndex === correctIndex) {
            return "bg-green-100 border-green-500 text-green-800";
          } else {
            return "bg-red-100 border-red-300 text-red-700";
          }
        };

        // ì•ˆì „í•œ ë¬¸ìì—´ ë Œë”ë§ í•¨ìˆ˜
        const safeRenderText = (value) => {
          if (typeof value === "string") {
            return value;
          } else if (typeof value === "object" && value !== null) {
            if (value.topic) return value.topic;
            if (value.category) return value.category;
            if (value.label) return value.label;
            return JSON.stringify(value);
          }
          return String(value);
        };

        // ë¬¸ì œ ë Œë”ë§ í•¨ìˆ˜
        const renderProblem = () => {
          if (!currentProblem) return null;

          // ë‹¨ì¼ ë¬¸ì œì¸ ê²½ìš°
          if (currentProblem.question && currentProblem.choices) {
            return (
              <div>
                <div className="mb-6">
                  <p className="text-lg mb-4">
                    <span className="font-bold">{currentProblem.question}</span>
                  </p>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4">
                  {currentProblem.choices?.map((choice, index) => (
                    <button
                      key={index}
                      onClick={() => handleAnswer(0, index)}
                      disabled={showAnswer}
                      className={`p-4 rounded-lg text-left transition-colors ${getButtonStyle(
                        0,
                        index
                      )}`}
                    >
                      <span className="font-semibold mr-2">{index + 1}.</span>
                      {choice}
                    </button>
                  ))}
                </div>

                {showAnswer && (
                  <div className="mt-6 p-4 bg-blue-50 rounded-lg">
                    <h4 className="font-semibold text-blue-800 mb-2">
                      ì •ë‹µ ë° í•´ì„¤
                    </h4>
                    <p className="text-blue-700">
                      <span className="font-bold">ì •ë‹µ:</span>{" "}
                      {currentProblem.correct + 1}ë²ˆ -{" "}
                      {currentProblem.choices[currentProblem.correct]}
                    </p>
                    <p className="text-blue-700 mt-2">
                      <span className="font-bold">í•´ì„¤:</span>{" "}
                      {currentProblem.explanation}
                    </p>
                  </div>
                )}
              </div>
            );
          }

          // ë‹¤ì¤‘ ë¬¸ì œì¸ ê²½ìš°
          if (
            currentProblem.questions &&
            Array.isArray(currentProblem.questions)
          ) {
            return (
              <div>
                {currentProblem.questions.map((questionObj, qIndex) => (
                  <div key={qIndex} className="mb-8">
                    <div className="mb-6">
                      <h4 className="text-lg font-semibold mb-2">
                        ë¬¸ì œ {qIndex + 1}
                      </h4>
                      <p className="text-lg mb-4">
                        <span className="font-bold">
                          {questionObj.question}
                        </span>
                      </p>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4">
                      {questionObj.choices?.map((choice, cIndex) => (
                        <button
                          key={`${qIndex}-${cIndex}`}
                          onClick={() => handleAnswer(qIndex, cIndex)}
                          disabled={showAnswer}
                          className={`p-4 rounded-lg text-left transition-colors ${getButtonStyle(
                            qIndex,
                            cIndex
                          )}`}
                        >
                          <span className="font-semibold mr-2">
                            {cIndex + 1}.
                          </span>
                          {choice}
                        </button>
                      ))}
                    </div>

                    {showAnswer && (
                      <div className="mt-6 p-4 bg-blue-50 rounded-lg">
                        <h4 className="font-semibold text-blue-800 mb-2">
                          ë¬¸ì œ {qIndex + 1} ì •ë‹µ ë° í•´ì„¤
                        </h4>
                        <p className="text-blue-700">
                          <span className="font-bold">ì •ë‹µ:</span>{" "}
                          {questionObj.correct + 1}ë²ˆ -{" "}
                          {questionObj.choices[questionObj.correct]}
                        </p>
                        <p className="text-blue-700 mt-2">
                          <span className="font-bold">í•´ì„¤:</span>{" "}
                          {questionObj.explanation}
                        </p>
                      </div>
                    )}
                  </div>
                ))}
              </div>
            );
          }

          return <div>ë¬¸ì œ í˜•ì‹ì„ ì¸ì‹í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>;
        };

        return (
          <div className="max-w-6xl mx-auto p-6 bg-white min-h-screen">
            {/* í—¤ë” */}
            <div className="text-center mb-8">
              <h1 className="text-3xl font-bold text-gray-800 mb-2">
                ğŸ­ JLPT N1 ë…í•´ ë¬¸ì œ ìƒì„±ê¸° (í™”ì ì‹œìŠ¤í…œ)
              </h1>
              <p className="text-gray-600">
                Claude AIê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ìƒˆë¡œìš´ N1 ë…í•´ ë¬¸ì œë¥¼ ìƒì„±í•©ë‹ˆë‹¤!
              </p>
              <p className="text-sm text-purple-600 mt-1">
                âœ¨ 24ê°€ì§€ í™”ì ê´€ì  ì§€ì› â€¢ ì£¼ì œë³„ ìµœì  í™”ì ìë™ ì„ íƒ â€¢ í˜„ì‹¤ì ì¸
                ë¬¸ì²´ êµ¬í˜„
              </p>
            </div>

            {/* ìƒíƒœ í‘œì‹œ */}
            <div className="grid md:grid-cols-4 gap-4 mb-6">
              <div className="bg-blue-50 p-4 rounded-lg text-center">
                <div className="text-lg font-semibold text-blue-800">
                  ì •ë‹µë¥ :{" "}
                  {score.total > 0
                    ? Math.round((score.correct / score.total) * 100)
                    : 0}
                  %
                </div>
                <div className="text-sm text-blue-600">
                  ({score.correct}/{score.total})
                </div>
              </div>
              <div className="bg-green-50 p-4 rounded-lg text-center">
                <div className="text-lg font-semibold text-green-800">
                  ìƒì„±ëœ ë¬¸ì œ: {generationHistory.length}ê°œ
                </div>
              </div>
              <div className="bg-purple-50 p-4 rounded-lg text-center">
                <div className="text-sm font-semibold text-purple-800">
                  {apiStatus}
                </div>
              </div>
              <div className="bg-orange-50 p-4 rounded-lg text-center">
                <div className="text-sm font-semibold text-orange-800">
                  í™”ì ì‹œìŠ¤í…œ í™œì„±í™”
                </div>
              </div>
            </div>

            {/* ê¸¸ì´ ì„ íƒ */}
            <div className="mb-6">
              <h3 className="text-lg font-semibold mb-3">ê¸€ ê¸¸ì´ ì„ íƒ</h3>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
                {Object.entries(lengthOptions).map(([key, option]) => (
                  <button
                    key={key}
                    onClick={() => setSelectedLength(key)}
                    className={`p-4 rounded-lg border-2 transition-colors text-left ${
                      selectedLength === key
                        ? "border-blue-500 bg-blue-50 text-blue-800"
                        : "border-gray-200 bg-white text-gray-700 hover:bg-gray-50"
                    }`}
                  >
                    <div className="flex items-center justify-between mb-2">
                      <div className="flex items-center">
                        <span className="text-xl mr-2">{option.icon}</span>
                        <span className="font-semibold">{option.label}</span>
                      </div>
                    </div>
                    <div className="text-sm text-gray-600">
                      <div className="mb-1">{option.description}</div>
                      <div className="grid grid-cols-2 gap-2 text-xs">
                        <div>
                          <span className="font-medium">ê¸¸ì´:</span>{" "}
                          {option.characterRange}
                        </div>
                        <div>
                          <span className="font-medium">ë¬¸ì œ:</span>{" "}
                          {option.questionCount}
                        </div>
                        <div>
                          <span className="font-medium">ì‹œê°„:</span>{" "}
                          {option.estimatedTime}ë¶„
                        </div>
                      </div>
                    </div>
                  </button>
                ))}
              </div>
            </div>

            {/* ìƒì„± ë°©ì‹ ì„ íƒ */}
            <div className="mb-6">
              <h3 className="text-lg font-semibold mb-3">ë¬¸ì œ ìƒì„± ë°©ì‹</h3>
              <div className="flex flex-wrap gap-2 mb-4">
                <button
                  onClick={() => setGenerationType("auto")}
                  className={`px-4 py-2 rounded-lg transition-colors ${
                    generationType === "auto"
                      ? "bg-blue-500 text-white"
                      : "bg-gray-100 text-gray-700 hover:bg-gray-200"
                  }`}
                >
                  ğŸ² ìë™ ìƒì„± (ì¶”ì²œ)
                </button>
                <button
                  onClick={() => setGenerationType("custom")}
                  className={`px-4 py-2 rounded-lg transition-colors ${
                    generationType === "custom"
                      ? "bg-blue-500 text-white"
                      : "bg-gray-100 text-gray-700 hover:bg-gray-200"
                  }`}
                >
                  âœï¸ ì»¤ìŠ¤í…€ í”„ë¡¬í”„íŠ¸
                </button>
                <button
                  onClick={() => setShowSpeakerInfo(!showSpeakerInfo)}
                  className={`px-4 py-2 rounded-lg transition-colors ${
                    showSpeakerInfo
                      ? "bg-purple-500 text-white"
                      : "bg-gray-100 text-gray-700 hover:bg-gray-200"
                  }`}
                >
                  ğŸ­ í™”ì ì •ë³´ {showSpeakerInfo ? "ìˆ¨ê¸°ê¸°" : "í‘œì‹œ"}
                </button>
              </div>

              {/* ì»¤ìŠ¤í…€ í”„ë¡¬í”„íŠ¸ ì…ë ¥ */}
              {generationType === "custom" && (
                <div className="mt-4">
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    ì»¤ìŠ¤í…€ í”„ë¡¬í”„íŠ¸ ì…ë ¥
                  </label>
                  <textarea
                    value={customPrompt}
                    onChange={(e) => setCustomPrompt(e.target.value)}
                    placeholder="ì›í•˜ëŠ” ì£¼ì œë‚˜ ìš”êµ¬ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”..."
                    className="w-full h-32 p-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  />
                  <p className="text-xs text-gray-500 mt-1">
                    ì˜ˆ: "í™˜ê²½ ë¬¸ì œì— ëŒ€í•œ ë…¼ì„¤ë¬¸ í˜•íƒœì˜ ë…í•´ ë¬¸ì œë¥¼
                    ë§Œë“¤ì–´ì£¼ì„¸ìš”"
                  </p>
                  <p className="text-xs text-blue-600 mt-1">
                    ì„ íƒí•œ ê¸€ ê¸¸ì´ ({lengthOptions[selectedLength]?.label})ì—
                    ì í•©í•œ í™”ìê°€ ìë™ ë°°ì •ë©ë‹ˆë‹¤.
                  </p>
                </div>
              )}
            </div>

            {/* ë¬¸ì œ ìƒì„± ë²„íŠ¼ */}
            <div className="text-center mb-8">
              <button
                onClick={generateProblem}
                disabled={
                  isGenerating ||
                  (generationType === "custom" && !customPrompt.trim())
                }
                className="bg-green-500 hover:bg-green-600 disabled:bg-gray-400 text-white px-8 py-3 rounded-lg text-lg font-semibold transition-colors flex items-center gap-2 mx-auto"
              >
                {isGenerating ? (
                  <>
                    <LoaderIcon />
                    AIê°€ ë…í•´ ë¬¸ì œ ìƒì„± ì¤‘...
                  </>
                ) : (
                  <>
                    ğŸš€ {generationType === "auto" ? "ìë™ ìƒì„±" : "ì»¤ìŠ¤í…€ ìƒì„±"}
                    <span className="text-sm font-normal">
                      ({lengthOptions[selectedLength]?.label})
                    </span>
                  </>
                )}
              </button>
              {isGenerating && (
                <p className="text-sm text-gray-600 mt-2">
                  {lengthOptions[selectedLength]?.label} í˜•íƒœì˜ N1 ë…í•´ ë¬¸ì œë¥¼
                  ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...
                </p>
              )}
            </div>

            {/* ë¬¸ì œ í‘œì‹œ */}
            {currentProblem && (
              <div className="bg-gray-50 p-6 rounded-lg mb-6">
                <div className="flex items-center justify-between mb-4">
                  <h3 className="text-xl font-semibold">
                    ë…í•´ ë¬¸ì œ (
                    {lengthOptions[currentProblem.length || selectedLength]
                      ?.label || "í‘œì¤€"}
                    )
                  </h3>
                  <div className="text-sm text-gray-500 text-right">
                    <div className="flex items-center gap-2">
                      <span>{currentProblem.source || "AI ìƒì„±"}</span>
                    </div>
                    <div>{currentProblem.displayedAt}</div>
                    {currentProblem.isBackup && (
                      <div className="text-yellow-600">âš ï¸ ë°±ì—… ë¬¸ì œ</div>
                    )}
                    {currentProblem.isError && (
                      <div className="text-red-600">ğŸ”´ ì˜¤ë¥˜ ëŒ€ì²´</div>
                    )}
                  </div>
                </div>

                {/* í™”ì ì •ë³´ í‘œì‹œ */}
                <SpeakerInfoCard
                  speaker={currentProblem.speaker}
                  speakerInfo={currentProblem.speakerInfo}
                  show={showSpeakerInfo}
                />

                {/* ë©”íƒ€ ì •ë³´ í‘œì‹œ */}
                {(currentProblem.topic ||
                  currentProblem.questionCount ||
                  currentProblem.lengthInfo) && (
                  <div className="mb-4 p-3 bg-blue-50 rounded border-l-4 border-blue-400">
                    {currentProblem.topic && (
                      <p className="text-sm text-blue-800">
                        <strong>ì£¼ì œ:</strong>{" "}
                        {safeRenderText(currentProblem.topic)}
                      </p>
                    )}
                    {currentProblem.genre && (
                      <p className="text-sm text-blue-800">
                        <strong>ì¥ë¥´:</strong>{" "}
                        {safeRenderText(currentProblem.genre)}
                      </p>
                    )}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-2 mt-2">
                      <div>
                        <span className="font-medium text-blue-800">
                          ê¸€ ê¸¸ì´:
                        </span>{" "}
                        <span className="text-blue-800">
                          {currentProblem.lengthInfo?.character_range ||
                            currentProblem.lengthInfo?.characterRange ||
                            lengthOptions[currentProblem.length]
                              ?.characterRange}
                        </span>
                      </div>
                      <div>
                        <span className="font-medium text-blue-800">
                          ë¬¸ì œ ìˆ˜:
                        </span>{" "}
                        <span className="text-blue-800">
                          {currentProblem.questions?.length || 1}ê°œ
                        </span>
                      </div>
                      <div>
                        <span className="font-medium text-blue-800">
                          ì˜ˆìƒ ì‹œê°„:
                        </span>{" "}
                        <span className="text-blue-800">
                          {lengthOptions[currentProblem.length]
                            ?.estimatedTime || 5}
                          ë¶„
                        </span>
                      </div>
                    </div>
                  </div>
                )}

                {/* ì§€ë¬¸ */}
                {currentProblem.length === "comparative" &&
                currentProblem.passage1 &&
                currentProblem.passage2 ? (
                  <div className="mb-6 space-y-4">
                    <div className="p-4 bg-white rounded border">
                      <h4 className="font-semibold mb-2 text-gray-700">
                        ì§€ë¬¸ 1
                      </h4>
                      <p className="text-gray-800 leading-relaxed text-lg">
                        {currentProblem.passage1}
                      </p>
                    </div>
                    <div className="p-4 bg-white rounded border">
                      <h4 className="font-semibold mb-2 text-gray-700">
                        ì§€ë¬¸ 2
                      </h4>
                      <p className="text-gray-800 leading-relaxed text-lg">
                        {currentProblem.passage2}
                      </p>
                    </div>
                  </div>
                ) : (
                  <div className="mb-6 p-4 bg-white rounded border">
                    <p className="text-gray-800 leading-relaxed text-lg">
                      {currentProblem.passage}
                    </p>
                  </div>
                )}

                {/* ë¬¸ì œ ë Œë”ë§ */}
                {renderProblem()}
              </div>
            )}

            {/* ìµœê·¼ ìƒì„± ì´ë ¥ */}
            {generationHistory.length > 0 && (
              <div className="mt-8">
                <h3 className="text-lg font-semibold mb-3">
                  ìµœê·¼ ìƒì„±ëœ ë¬¸ì œë“¤
                </h3>
                <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-3">
                  {generationHistory.slice(0, 6).map((problem) => (
                    <div
                      key={problem.id}
                      className="bg-gray-100 p-3 rounded text-sm"
                    >
                      <div className="flex justify-between items-center mb-1">
                        <div className="flex items-center gap-2">
                          <span className="font-semibold">
                            ë…í•´ (
                            {lengthOptions[problem.length]?.label || "í‘œì¤€"})
                          </span>
                          {/* í™”ì ì •ë³´ë¥¼ ì´ë ¥ì—ì„œë„ í‘œì‹œ */}
                          {(problem.speakerInfo || problem.speaker) && (
                            <span className="speaker-badge">
                              {(problem.speakerInfo || problem.speaker).label}
                            </span>
                          )}
                        </div>
                        <span className="text-gray-500 text-xs">
                          {problem.source}
                        </span>
                      </div>
                      <p className="text-gray-700 truncate">
                        {safeRenderText(problem.topic) ||
                          problem.passage?.substring(0, 30)}
                        ...
                      </p>
                      <div className="flex justify-between items-center mt-1">
                        <p className="text-xs text-gray-500">
                          {problem.displayedAt}
                        </p>
                        <div className="flex items-center gap-1">
                          {problem.trapDifficulty && (
                            <span
                              className={`text-xs px-1 py-0.5 rounded ${
                                problem.trapDifficulty === "ê³ ë‚œì´ë„"
                                  ? "bg-red-100 text-red-600"
                                  : "bg-green-100 text-green-600"
                              }`}
                            >
                              {problem.trapDifficulty}
                            </span>
                          )}
                          <span className="text-xs bg-gray-200 text-gray-600 px-1 py-0.5 rounded">
                            {lengthOptions[problem.length]?.estimatedTime || 5}
                            ë¶„
                          </span>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* í‘¸í„° */}
            <div className="mt-12 text-center text-gray-500 text-sm">
              <p className="font-semibold">
                JLPT N1 ëŒ€ë¹„ìš© ë…í•´ ë¬¸ì œ ìƒì„±ê¸° (í™”ì ì‹œìŠ¤í…œ í†µí•©)
              </p>
              <p className="mt-1">
                24ê°€ì§€ í™”ì ê´€ì  â€¢ ì£¼ì œë³„ ìµœì  í™”ì ì„ íƒ â€¢ í˜„ì‹¤ì ì¸ ë¬¸ì²´ êµ¬í˜„ â€¢
                N1 í•¨ì • ìš”ì†Œ í¬í•¨
              </p>
              <div className="flex justify-center items-center gap-4 mt-2 text-xs">
                <span>ğŸ­ í™”ì ì‹œìŠ¤í…œ</span>
                <span>ğŸ¯ ì •í™•í•œ ë¬¸ì œ ìˆ˜ ë³´ì¥</span>
                <span>âš¡ ìµœì í™”ëœ ì„±ëŠ¥</span>
                <span>ğŸ§© ì„¸ë¶€ ìœ í˜• ë¶„ì„</span>
              </div>
              <p className="mt-1">
                ì‹¤ì œ ì‹œí—˜ê³¼ëŠ” ë‹¤ë¥¼ ìˆ˜ ìˆìœ¼ë‹ˆ ì°¸ê³ ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©í•´ì£¼ì„¸ìš”.
              </p>
            </div>
          </div>
        );
      };

      // React 18 ë°©ì‹ìœ¼ë¡œ ì•± ë Œë”ë§
      const root = createRoot(document.getElementById("root"));
      root.render(<ReadingGenerator />);
    </script>
  </body>
</html>
